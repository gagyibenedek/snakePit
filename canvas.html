<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
 
<script>
var canvas;
var ctx;

var xPos;
var yPos;

var xTar;
var yTar;

var timer;
var bonusTimer;
var timerValue = 100;

var direction;


function doKeyDown(e) {

if(e.keyCode == 97 && direction != 100){       //a  
	direction = e.keyCode;
	} 

 if(e.keyCode == 119 && direction != 115){     //s 
	direction = e.keyCode;
	} 
	
 if(e.keyCode == 100 && direction != 97){     //d  
	direction = e.keyCode;
	} 
	
 if(e.keyCode == 115 && direction != 119){     //w  
	direction = e.keyCode;
	} 
	
if(e.keyCode == 43 && timerValue > 100){       //+
	window.clearInterval(timer);
	timerValue -= 50;
	 timer = window.setInterval(function () {draw()},timerValue);
}

if(e.keyCode == 45 && timerValue < 1000){      //-
	window.clearInterval(timer);
	timerValue += 50;
	timer = window.setInterval(function () {draw()},timerValue);
}

}

function init() {
  canvas = document.getElementById('canvas');
  if (canvas.getContext) {
    ctx = canvas.getContext("2d");   
	ctx.fillStyle   = '#FFFFFF'; // set canvas background color
	ctx.fillRect  (0,   0, 400, 400);  // now fill the canvas
  }
  
	window.addEventListener( "keypress", doKeyDown, false );
  
	xPos = 150;
	yPos = 150;
  
	xTar = xPos;
	yTar = yPos;
	
	direction = 97;
}

function draw() {
	var cropX;
	var cropY;
	var cropSizeX;
	var cropSizeY;

	if(direction == 97){ // a
		xTar -= 5;
		
		cropX = xTar + 2;
		cropY = yTar - 2;
		cropSizeX = -4;
		cropSizeY = 4;
	} else  if(direction == 119){ // w
		yTar -= 5;
		
		cropX = xTar + 2;
		cropY = yTar - 2;
		cropSizeX = - 4;
		cropSizeY = 4;
	} else if(direction == 100){ // d
		xTar += 5;
		
		cropX = xTar + 2;
		cropY = yTar - 2;
		cropSizeX = - 4;
		cropSizeY = 4;
	} else  if(direction == 115){ // s
		yTar += 5; 
		
		cropX = xTar + 2;
		cropY = yTar - 2;
		cropSizeX = -4;
		cropSizeY = 4;
	}
	

	var whatColor = ctx.getImageData(cropX,cropY,cropSizeX,cropSizeY);
	
		for (var i = 0; i < 4 * 4 * 4; i += 4) {
						  
			if (whatColor.data[i] != 255 || whatColor.data[i+1] != 255 
				|| whatColor.data[i+2] != 255) {
				alert("black collision");
				stop();
				break;
			}
			  
		}
	

	ctx.beginPath();
	ctx.moveTo(xPos,yPos);
	ctx.lineTo(xTar,yTar);
	ctx.lineWidth = 5;
	ctx.closePath();
	ctx.stroke();
	
	  xPos = xTar;
  yPos = yTar;
}

function drawBonus(){
	var imageObj = new Image();

    imageObj.onload = function() {
		ctx.drawImage(imageObj, 69, 50, 10, 10);
    };
    imageObj.src = 'gombaaa.jpg';
}

function start() {
  timer = window.setInterval(function () {draw()},timerValue);
  bonusTimer = window.setInterval(function () {drawBonus()},1000);
}

function stop() {
  window.clearInterval(timer);
  canvas.width = canvas.width;
  init();
}
</script>
 
</head>
<body onload="init();" style="background-color:black">
  <canvas id="canvas" width="400" height="400"></canvas>
  <br />
  
  <button  onclick="start()"  >Start</button> 
  <button  onclick="stop()"  >Stop</button> 
</body>
</html>